{
    "$schema": "http://json-schema.org/draft-07/schema",
    "$id": "https://github.com/AusSRC/POSSUM_workflows/master/nextflow_schema.json",
    "title": "POSSUM workflow pipeline",
    "description": "Pipeline execution tool for the POSSUM science team. Will run the entire workflow including downloading of footprints from CASDA, running linmos and source finding.",
    "type": "object",
    "definitions": {
        "environment": {
            "title": "Environment",
            "type": "object",
            "description": "Environment details for the execution of the POSSUM workflow in the AusSRC shared file system.",
            "default": "",
            "properties": {      
                "WORKDIR": {
                    "type": "string",
                    "description": "Working directory in the shared file system to save all POSSUM workflow files",
                    "default": "/mnt/shared/home/ashen/outputs/tmp"
                },
                "SINGULARITY_CACHEDIR": {
                    "type": "string",
                    "description": "Directory where singularity images are cached.",
                    "default": "/mnt/shared/possum/apps/singularity"
                }
            },
            "required": [
                "WORKDIR",
                "SINGULARITY_CACHEDIR"
            ]
        },
        "casda": {
            "title": "CASDA",
            "type": "object",
            "description": "CASDA credentials for downloading POSSUM footprints from the archive.",
            "default": "",
            "properties": {
                "SBIDS": {
                    "type": "string",
                    "description": "Scheduling block IDs of footprints to download from CASDA (comma separated string)"
                },
                "CASDA_USERNAME": {
                    "type": "string",
                    "description": "Username for OPAL account"
                },
                "CASDA_PASSWORD": {
                    "type": "string",
                    "description": "Password for OPAL account"
                },
                "CASDA_CUBE_TYPE": {
                    "type": "string",
                    "description": "Cube type parameter for CASDA file search",
                    "default": "cube"
                },
                "CASDA_CUBE_FILENAME": {
                    "type": "string",
                    "description": "Filename query string for CASDA cube download",
                    "default": "image.restored.%SB$SBID%.cube.MilkyWay.contsub.fits"
                },
                "CASDA_WEIGHTS_TYPE": {
                    "type": "string",
                    "description": "Weight type parameter for CASDA file search",
                    "default": "cube"
                },
                "CASDA_WEIGHTS_FILENAME": {
                    "type": "string",
                    "description": "Weight query string for CASDA weight cube download",
                    "default": "weights%SB$SBID%.cube.MilkyWay.fits"
                }
            },
            "required": [
                "SBIDS",
                "CASDA_USERNAME",
                "CASDA_PASSWORD"
            ]
        },
        "linmos": {
            "title": "Linmos",
            "type": "object",
            "description": "Information required for the execution of the linear mosaicking application.",
            "default": "",
            "properties": {
                "LINMOS_OUTPUT_IMAGE_CUBE": {
                    "type": "string",
                    "description": "Filename of the output mosaicked image cube",
                    "default": "mosaicked"
                },
                "LINMOS_CONFIG_FILENAME": {
                    "type": "string",
                    "description": "Filename of the generated linmos configuration file",
                    "default": "linmos.config"
                },
                "LINMOS_CLUSTER_OPTIONS": {
                    "type": "string",
                    "description": "Cluster configuration for the execution of linmos.",
                    "default": "--nodes=12 --ntasks-per-node=12"
                }
            },
            "required": [
            ]
        },
        "frion": {
            "title": "FRion",
            "type": "object",
            "description": "Ionospheric correction component.",
            "default": "",
            "properties": {
                "FRION_IMAGE": {
                    "type": "string",
                    "description": "Docker image with FRion installed.",
                    "default": "aussrc/frion:latest"
                },
                "FRION_PREDICT_OUTFILE": {
                    "type": "string",
                    "description": "Output file from FRion predict.",
                    "default": "frion.prediction.txt"
                }
            },
            "required": [
                "FRION_IMAGE",
                "FRION_PREDICT_OUTFILE"
            ]
        }
    },
    "allOf": [
        {
            "$ref": "#/definitions/environment"
        },
        {
            "$ref": "#/definitions/casda"
        },
        {
            "$ref": "#/definitions/linmos"
        }
    ]
}