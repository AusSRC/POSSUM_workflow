profiles {
    carnaby {
        process {
            executor = 'slurm'
            queue = 'cpu'
            module = ['singularity']

            withName: beamcon_3D {
                module = ['mpich', 'singularity']
                executor = 'slurm'
                clusterOptions = '--nodes=4 --ntasks-per-node=1'
                queue = 'cpu'
            }

            withName: beamcon_2D {
                module = ['mpich', 'singularity']
                executor = 'slurm'
                clusterOptions = '--nodes=1 --ntasks-per-node=1'
                queue = 'cpu'
            }

            withName: linmos {
                module = ['mpich', 'singularity']
                executor = 'slurm'
                clusterOptions = '--nodes=1 --ntasks-per-node=1'
                queue = 'cpu'
            }
        }

        params {
            WORKDIR = "/mnt/shared/possum/runs"
            SCRATCH_ROOT = "/mnt/shared"
            CASADATA = "/mnt/shared/home/ashen/.casa/data"

            HPX_TILE_CONFIG = "/mnt/shared/possum/config/hpx_tile_config.json"
            HPX_TILE_TEMPLATE = "/mnt/shared/possum/config/tile-template.fits"
            HPX_TILE_MAP = "/mnt/shared/possum/config/pixel.map.test.csv"

            LINMOS_CONFIG_FILE = "/mnt/shared/possum/config/linmos.config"

            CASDA_CREDENTIALS = "/mnt/shared/possum/config/casda.ini"
            SINGULARITY_CACHEDIR = "/mnt/shared/possum/apps/singularity"
            SINGULARITY_TMPDIR = "/tmp"
        }

        singularity {
            enabled = true
            cacheDir = "/mnt/shared/possum/apps/singularity/"
        }

        docker.enabled = false
    }

    setonix {
        process {
            executor = 'slurm'
            queue = 'work'
            module = ['singularity/3.8.6']
            clusterOptions = "--account=ja3"

            withName: pull_racstools_image {
                executor = 'slurm'
                queue = 'work'
                module = ['singularity/3.8.6']
                clusterOptions = '--mem-per-cpu=32G'
            }

            withName: frion_correct {
                executor = 'slurm'
                queue = 'work'
                module = ['singularity/3.8.6']
                clusterOptions = '--account=ja3 --mem-per-cpu=128G'
            }

            withName: beamcon_3D {
                executor = 'slurm'
                queue = 'work'
                module = ['singularity/3.8.6']
                clusterOptions = '--account=ja3 --nodes=4 --ntasks-per-node=4 --mem-per-cpu=32G'
            }

            withName: linmos {
                executor = 'slurm'
                queue = 'work'
                module = ['singularity/3.8.6']
                clusterOptions = '--account=ja3 --nodes=1 --ntasks-per-node=1'
	        }
        }

        env {
            XDG_CACHE_HOME = "/scratch/ja3/ashen/"
        }

        params {
            WORKDIR = "/scratch/ja3/possum/runs"
            SCRATCH_ROOT = "/scratch"
            CASADATA = "/scratch/ja3/possum/config"

            CASDA_CREDENTIALS = "/scratch/ja3/possum/config/casda.ini"

            HPX_TILE_CONFIG = "/scratch/ja3/possum/config/hpx_tile_config.json"
            HPX_TILE_TEMPLATE = "/scratch/ja3/possum/config/tile-template.fits"
            HPX_TILE_MAP = "/scratch/ja3/possum/config/hpx_pixel_tile_map.csv"
            LINMOS_CONFIG_FILE = "/scratch/ja3/possum/config/linmos.config"
            SINGULARITY_CACHEDIR = "/scratch/ja3/possum/apps/singularity"
            SINGULARITY_TMPDIR = "/scratch/ja3/possum/tmp"
        }

        singularity {
            enabled = true
            cacheDir = "/scratch/ja3/possum/apps/singularity/"
        }

        docker.enabled = false
    }
}

params {
    BEAMCON_NTASKS = 16
    BEAMCON_2D_SUFFIX = "sm"
    BEAMCON_3D_SUFFIX = "total"
    BMAJ = 18
    BMIN = 18
    BPA = 0
    ZERO_SPLIT_CUBE_SUBDIR = "nan_to_zero"

    FRION_PREDICT_OUTFILE = "frion_predict.txt"
    FRION_Q_CUBE_FILENAME = "q.fits"
    FRION_U_CUBE_FILENAME = "u.fits"

    HPX_TILE_PREFIX = "PSM"
    SPLIT_CUBE_SUBDIR = "split"
    EVALUATION_FILES_DIR = "evaluation_files"
    TILE_COMPONENT_OUTPUT_DIR = "components"
    HPX_TILE_OUTPUT_DIR = "tiles"

    LINMOS_CONFIG_TEMPLATE = "/mnt/shared/wallaby/config/linmos.config"
    LINMOS_CONFIG_SUBDIR = "linmos_config"
    LINMOS_IMAGE = "docker://csirocass/askapsoft:1.9.1-casacore3.5.0-mpich"

    RACS_TOOLS_IMAGE = "docker://alecthomson/racstools"
    MONTAGE_IMAGE = "docker://astroaustin/montage:latest"
    IONOSPHERIC_CORRECTION_IMAGE = "docker://aussrc/frion:latest"
    METADATA_IMAGE = "docker://aussrc/metadata_tools:latest"
    HPX_TILING_IMAGE = "docker://aussrc/hpx_tiles:latest"
    MOSAICKING_COMPONENTS_IMAGE = "docker://aussrc/mosaicking_tools:latest"
}